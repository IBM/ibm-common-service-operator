apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata: 
  name: ibm-common-service-operator-{{ .Values.global.operatorNamespace }}
  labels:
    component-id: {{ .Chart.Name }}
    {{- if .Values.cpfs.labels }}
      {{- with .Values.cpfs.labels }}
        {{- toYaml . | nindent 4 }}
      {{- end }}
    {{- end}}
    {{- if .Values.cpfs.clusterLabels }}
      {{- with .Values.cpfs.clusterLabels }}
        {{- toYaml . | nindent 4 }}
      {{- end }}
    {{- end}}
rules:   
  - apiGroups: 
      - ""
    resourceNames: 
      - common-service-maps
    resources: 
      - configmaps
    verbs: 
      - delete
      - update
  - apiGroups: 
      - ""
    resources: 
      - configmaps
    verbs: 
      - create
      - get
      - list
      - watch
      - update
  - apiGroups: 
      - ""
    resources: 
      - secrets
    verbs: 
      - get
  - apiGroups: 
      - storage.k8s.io
    resources: 
      - storageclasses
    verbs: 
      - get
      - list
  - apiGroups: 
      - admissionregistration.k8s.io
    resources: 
      - mutatingwebhookconfigurations
      - validatingwebhookconfigurations
    verbs: 
      - get
      - delete
  - apiGroups: 
      - config.openshift.io
    resources: 
      - infrastructures
    verbs: 
      - get
  - apiGroups: 
      - rbac.authorization.k8s.io
    resources: 
      - clusterrolebindings
      - clusterroles
    verbs: 
      - get
      - delete
      - list
      - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata: 
  name: ibm-common-service-operator-{{ .Values.global.operatorNamespace }}
  labels:
    component-id: {{ .Chart.Name }}
    {{- if .Values.cpfs.labels }}
      {{- with .Values.cpfs.labels }}
        {{- toYaml . | nindent 4 }}
      {{- end }}
    {{- end}}
    {{- if .Values.cpfs.clusterLabels }}
      {{- with .Values.cpfs.clusterLabels }}
        {{- toYaml . | nindent 4 }}
      {{- end }}
    {{- end}}
roleRef: 
  kind: ClusterRole
  apiGroup: rbac.authorization.k8s.io
  name: ibm-common-service-operator-{{ .Values.global.operatorNamespace }}
subjects:   
  - kind: ServiceAccount
    name: ibm-common-service-operator
    namespace: {{ .Values.global.operatorNamespace }}

---
